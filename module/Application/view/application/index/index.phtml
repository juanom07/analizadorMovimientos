<div class="row">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div>
            <form id="form" action="ajaxupload.php" method="post" enctype="multipart/form-data">
                <input id="uploadImage" type="file" name="archivo" />
                <input class="btn btn-success" type="submit" value="Upload">
            </form>
            </div>
            <div class="panel-heading mt-3">
                <h3 class="panel-title">Movimientos</h3>
            </div>
            <div class="panel-body" id="divIndex">
                <table id="tablaMovimientos" class="table table-hover">
                    <thead>
                        <tr class="">
                            <th class="text-center">Fecha</th>
                            <th class="text-center">Motivo</th>
                            <th class="text-center">Detalle</th>
                            <th class="text-center">Valor</th>
                        </tr>
                    </thead>
                    <tbody id="bodyMovimientos">
                    
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
var url = '<?= $this->serverUrl(); ?>';
var arrMovimientosJSON = <?= $arrMovimientosJSON ?>;

function dibujarTablaMovimientos(){
    $('#bodyMovimientos').find('tr').remove();
    
    for (var i = 0; i < arrMovimientosJSON.length; i++)
    {
        var movimiento = arrMovimientosJSON[i];
        var body = document.getElementById("bodyMovimientos");
        var row = body.insertRow();
        
        row.id = i;
        
        var fecha = row.insertCell(0);
        var motivo = row.insertCell(1);
        var detalle = row.insertCell(2);
        var valor = row.insertCell(3);
        
        fecha.innerHTML = movimiento.fecha.substring(0,16);
        motivo.innerHTML = movimiento.motivoMovimiento.descripcion;
        detalle.innerHTML = movimiento.descripcion;
        valor.innerHTML = movimiento.valor;

        if (parseFloat(movimiento.valor) > 0){
            // row.classList.add("table-success");
            valor.style.color = 'green';
        }else{
            // row.classList.add("table-danger");
            valor.style.color = 'red';
        }
    }
}

$(document).ready(function (e) {
    dibujarTablaMovimientos();

    $("#form").on('submit',(function(e) {
        e.preventDefault();
        $.ajax({
            url: url + '/',
            type: "POST",
            data:  new FormData(this),
            contentType: false,
            cache: false,
            processData:false,
            beforeSend : function(){
                //$("#preview").fadeOut();
                $("#err").fadeOut();
            },
            success: function(data){
                if(data=='invalid'){
                    // invalid file format.
                    $("#err").html("Invalid File !").fadeIn();
                }else{
                    // view uploaded file.
                    $("#preview").html(data).fadeIn();
                    $("#form")[0].reset(); 
                }
            },
            error: function(e) {
                $("#err").html(e).fadeIn();
            }          
        });
    }));
});
</script>